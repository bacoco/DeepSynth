# PRD-TASKMASTER Technical Reference

## Architecture Overview

PRD-TASKMASTER consists of:
1. **Task Parser**: Extracts tasks from markdown files
2. **Pattern Classifier**: Groups tasks by domain
3. **Skill Recommender**: Maps patterns to skill needs
4. **Report Generator**: Creates analysis reports
5. **NEXUS Bridge**: Outputs data for directive generation

## File Detection Patterns

### Supported Filenames
- `*PRD*.md`, `*prd*.md` - Product requirements
- `*TODO*.md`, `*todo*.md` - Task lists
- `*TASK*.md`, `*task*.md` - Task planning
- `*REQUIREMENTS*.md` - Requirements docs
- `*ROADMAP*.md` - Project roadmaps

### Task Extraction Patterns

**Checkbox Tasks**:
```markdown
- [ ] Uncompleted task
- [x] Completed task
- [X] Completed task (uppercase)
```

**Numbered Lists**:
```markdown
1. First task
2. Second task
3. Third task
```

**Bullet Points**:
```markdown
- Task description
* Another task
- Yet another task
```

**Header Tasks**:
```markdown
### Implement feature X
#### Create component Y
```

## Domain Classification System

### Keyword-Based Classification

Each domain has associated keywords:

```python
DOMAIN_PATTERNS = {
    "api": ["api", "endpoint", "rest", "graphql", ...],
    "testing": ["test", "testing", "unit test", ...],
    "deployment": ["deploy", "docker", "kubernetes", ...],
    # ... etc
}
```

Tasks are classified by keyword matching (case-insensitive).

### Multi-Domain Tasks

Tasks can belong to multiple domains:
```
"Implement API endpoint with tests"
â†’ Classified as: ["api", "testing"]
```

## Skill Recommendation Algorithm

### Step 1: Pattern Frequency
```
if task_count >= 8: priority = "critical"
elif task_count >= 5: priority = "high"
elif task_count >= 3: priority = "medium"
else: priority = "low"
```

### Step 2: Priority Adjustment
- Base priority from skill mapping
- Adjusted by task frequency
- Sorted by task count

### Step 3: Capability Mapping
Each domain maps to specific capabilities:
```python
{
  "api": [
    "Rate limiting and retry logic",
    "Error handling patterns",
    "Response caching",
    "API client generation"
  ]
}
```

## Report Structure

### Analysis Report JSON
```json
{
  "analysis_timestamp": 1234567890,
  "repository": "/path/to/repo",
  "prd_files_analyzed": ["prd.md", "todo.md"],
  "total_tasks": 42,
  "summary": {
    "total_patterns_detected": 5,
    "skills_recommended": 3,
    "high_priority_skills": 2,
    "task_coverage": 35
  },
  "task_patterns": {
    "api": {
      "frequency": 12,
      "example_tasks": ["...", "...", "..."]
    }
  },
  "skill_recommendations": [
    {
      "domain": "api",
      "skill_name": "api-master",
      "priority": "high",
      "task_count": 12,
      "example_tasks": ["...", "..."],
      "reason": "Detected 12 tasks related to api",
      "recommended_capabilities": ["...", "..."]
    }
  ]
}
```

## Integration Points

### With NEXUS
```bash
# 1. Run PRD analysis
python prd_analyzer.py --output prd_report.json

# 2. Generate directives from report
cd ../.claude/skills/nexus/scripts
python directive_generator.py --report ../../../../prd_report.json
```

### With SOUL
PRD-TASKMASTER can read SOUL data to enhance recommendations:
- Check completed tasks from previous sessions
- Identify recurring problem patterns
- Adjust priorities based on historical data

## Command Line Interface

### Basic Usage
```bash
./prd_analyzer.py
```

### With Options
```bash
./prd_analyzer.py \
  --repo /path/to/project \
  --output analysis.json \
  --quiet
```

### Parameters
- `--repo`: Repository path (default: current directory)
- `--output`: Output file for JSON report (default: prd_analysis_report.json)
- `--quiet`: Suppress console output

## Output Files

### prd_analysis_report.json
Complete analysis report with:
- All detected tasks
- Pattern analysis
- Skill recommendations
- Priority scores

### .claude/skill-directives/*.md
Generated by NEXUS using the analysis report.

## Extensibility

### Adding Custom Domains

Edit `DOMAIN_PATTERNS` in `prd_analyzer.py`:
```python
DOMAIN_PATTERNS = {
    # ... existing domains ...
    "custom_domain": ["keyword1", "keyword2", "keyword3"]
}
```

Add to `SKILL_RECOMMENDATIONS`:
```python
SKILL_RECOMMENDATIONS = {
    # ... existing mappings ...
    "custom_domain": {
        "name": "custom-skill-name",
        "priority": "medium"
    }
}
```

### Custom Task Patterns

Add regex patterns in `parse_tasks_from_file()`:
```python
# Pattern 5: Custom format
custom_tasks = re.findall(r'YOUR_REGEX_HERE', content, re.MULTILINE)
tasks.extend([{"text": t.strip(), "file": str(filepath), "type": "custom"} for t in custom_tasks])
```

## Performance Considerations

### File Scanning
- Only scans markdown files
- Skips binary files and hidden directories
- Caches parsed results per file

### Pattern Matching
- Case-insensitive keyword matching
- O(n*m) complexity (n=tasks, m=domains)
- Optimized for typical project sizes (<1000 tasks)

### Memory Usage
- Loads all tasks in memory
- Report stored as JSON
- Typical usage: <10MB for large projects

## Best Practices

1. **Regular Updates**: Run analysis after PRD changes
2. **Iterative Refinement**: Adjust thresholds based on results
3. **Domain Customization**: Add project-specific domains
4. **Integration**: Combine with SOUL for historical context
5. **Validation**: Review recommendations before skill creation

## Troubleshooting

### No Tasks Detected
- Check file naming matches patterns
- Verify markdown formatting
- Increase pattern sensitivity

### Wrong Domain Classification
- Add domain-specific keywords
- Adjust classification logic
- Review example tasks

### Low Priority Skills
- Reduce threshold in configuration
- Combine related tasks manually
- Check task count minimums
